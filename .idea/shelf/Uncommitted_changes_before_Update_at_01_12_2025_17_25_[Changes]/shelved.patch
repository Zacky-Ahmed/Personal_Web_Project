Index: Gemora/src/main/java/gem/gembro/controller/GemstoneController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package gem.gembro.controller;\r\n\r\nimport gem.gembro.model.Gemstone;\r\nimport gem.gembro.model.Seller;\r\nimport gem.gembro.model.User;\r\nimport gem.gembro.service.GemstoneService;\r\nimport gem.gembro.service.SellerService;\r\nimport gem.gembro.service.UserService;\r\nimport org.springframework.beans.factory.annotation.Autowired;\r\nimport org.springframework.core.io.FileSystemResource;\r\nimport org.springframework.core.io.Resource;\r\nimport org.springframework.http.HttpHeaders;\r\nimport org.springframework.http.HttpStatus;\r\nimport org.springframework.http.MediaType;\r\nimport org.springframework.http.ResponseEntity;\r\nimport org.springframework.web.bind.annotation.*;\r\n\r\nimport java.io.File;\r\nimport java.nio.file.Files;\r\nimport java.nio.file.Path;\r\nimport java.nio.file.Paths;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\nimport java.util.Map;\r\n\r\n@RestController\r\n@RequestMapping(\"/api/gemstones\")\r\n@CrossOrigin(origins = \"*\")\r\npublic class GemstoneController {\r\n    @Autowired\r\n    private GemstoneService gemstoneService;\r\n\r\n    @Autowired\r\n    private SellerService sellerService;\r\n\r\n    @Autowired\r\n    private UserService userService;\r\n\r\n    @PostMapping\r\n    public ResponseEntity<Gemstone> createGemstone(@RequestBody Gemstone gemstone) {\r\n        return ResponseEntity.status(HttpStatus.CREATED).body(gemstoneService.createGemstone(gemstone));\r\n    }\r\n\r\n    @GetMapping(\"/{id}\")\r\n    public ResponseEntity<Gemstone> getGemstoneById(@PathVariable Long id) {\r\n        return gemstoneService.getGemstoneById(id)\r\n                .map(gemstone -> ResponseEntity.ok(gemstone))\r\n                .orElse(ResponseEntity.notFound().build());\r\n    }\r\n\r\n    @GetMapping(\"/{id}/contact\")\r\n    public ResponseEntity<?> getGemstoneSellerContact(@PathVariable Long id) {\r\n        try {\r\n            Gemstone gemstone = gemstoneService.getGemstoneById(id)\r\n                    .orElseThrow(() -> new RuntimeException(\"Gemstone not found\"));\r\n\r\n            Seller seller = sellerService.getSellerById(gemstone.getSellerId())\r\n                    .orElseThrow(() -> new RuntimeException(\"Seller not found for this gemstone\"));\r\n\r\n            User user = userService.getUserById(seller.getUserId())\r\n                    .orElseThrow(() -> new RuntimeException(\"User not found for this seller\"));\r\n\r\n            Map<String, Object> response = new HashMap<>();\r\n            response.put(\"sellerBusinessName\", seller.getBusinessName());\r\n            response.put(\"sellerAddress\", seller.getAddress());\r\n            response.put(\"sellerId\", seller.getId());\r\n            response.put(\"phoneNumber\", user.getPhoneNumber());\r\n            response.put(\"email\", user.getEmail());\r\n\r\n            return ResponseEntity.ok(response);\r\n        } catch (RuntimeException e) {\r\n            Map<String, String> error = new HashMap<>();\r\n            error.put(\"error\", e.getMessage());\r\n            return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);\r\n        }\r\n    }\r\n\r\n    @GetMapping\r\n    public ResponseEntity<List<Gemstone>> getAllGemstones(\r\n            @RequestParam(required = false) String status,\r\n            @RequestParam(required = false) String type,\r\n            @RequestParam(required = false) String origin) {\r\n        \r\n        if (status != null && status.equalsIgnoreCase(\"active\")) {\r\n            return ResponseEntity.ok(gemstoneService.getActiveGemstones());\r\n        }\r\n        if (type != null) {\r\n            return ResponseEntity.ok(gemstoneService.getGemstonesByType(type));\r\n        }\r\n        if (origin != null) {\r\n            return ResponseEntity.ok(gemstoneService.getGemstonesByOrigin(origin));\r\n        }\r\n        return ResponseEntity.ok(gemstoneService.getAllGemstones());\r\n    }\r\n\r\n    @GetMapping(\"/seller/{sellerId}\")\r\n    public ResponseEntity<List<Gemstone>> getGemstonesBySellerId(@PathVariable Long sellerId) {\r\n        return ResponseEntity.ok(gemstoneService.getGemstonesBySellerId(sellerId));\r\n    }\r\n\r\n    @GetMapping(\"/premium\")\r\n    public ResponseEntity<List<Gemstone>> getPremiumBoostedGemstones() {\r\n        return ResponseEntity.ok(gemstoneService.getPremiumBoostedGemstones());\r\n    }\r\n\r\n    @PutMapping(\"/{id}\")\r\n    public ResponseEntity<Gemstone> updateGemstone(@PathVariable Long id, @RequestBody Gemstone gemstone) {\r\n        gemstone.setId(id);\r\n        return ResponseEntity.ok(gemstoneService.updateGemstone(gemstone));\r\n    }\r\n\r\n    @PostMapping(\"/{id}/premium-boost\")\r\n    public ResponseEntity<?> activatePremiumBoost(@PathVariable Long id, @RequestBody Map<String, Integer> request) {\r\n        try {\r\n            int days = request.getOrDefault(\"days\", 2);\r\n            return ResponseEntity.ok(gemstoneService.activatePremiumBoost(id, days));\r\n        } catch (RuntimeException e) {\r\n            Map<String, String> error = new HashMap<>();\r\n            error.put(\"error\", e.getMessage());\r\n            return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);\r\n        }\r\n    }\r\n\r\n    @DeleteMapping(\"/{id}/premium-boost\")\r\n    public ResponseEntity<?> deactivatePremiumBoost(@PathVariable Long id) {\r\n        try {\r\n            return ResponseEntity.ok(gemstoneService.deactivatePremiumBoost(id));\r\n        } catch (RuntimeException e) {\r\n            Map<String, String> error = new HashMap<>();\r\n            error.put(\"error\", e.getMessage());\r\n            return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);\r\n        }\r\n    }\r\n\r\n    @DeleteMapping(\"/{id}\")\r\n    public ResponseEntity<Void> deleteGemstone(@PathVariable Long id) {\r\n        gemstoneService.deleteGemstone(id);\r\n        return ResponseEntity.noContent().build();\r\n    }\r\n\r\n    @GetMapping(\"/{id}/certificate/download\")\r\n    public ResponseEntity<Resource> downloadCertificate(@PathVariable Long id) {\r\n        try {\r\n            Gemstone gemstone = gemstoneService.getGemstoneById(id)\r\n                    .orElseThrow(() -> new RuntimeException(\"Gemstone not found\"));\r\n            \r\n            if (gemstone.getCertificateFilePath() == null || gemstone.getCertificateFilePath().trim().isEmpty()) {\r\n                Map<String, String> error = new HashMap<>();\r\n                error.put(\"error\", \"Certificate file not available for this gemstone\");\r\n                return ResponseEntity.status(HttpStatus.NOT_FOUND).build();\r\n            }\r\n            \r\n            Path filePath = Paths.get(gemstone.getCertificateFilePath());\r\n            File file = filePath.toFile();\r\n            \r\n            if (!file.exists() || !file.isFile()) {\r\n                Map<String, String> error = new HashMap<>();\r\n                error.put(\"error\", \"Certificate file not found\");\r\n                return ResponseEntity.status(HttpStatus.NOT_FOUND).build();\r\n            }\r\n            \r\n            Resource resource = new FileSystemResource(file);\r\n            String contentType = Files.probeContentType(filePath);\r\n            if (contentType == null) {\r\n                contentType = \"application/octet-stream\";\r\n            }\r\n            \r\n            String fileName = file.getName();\r\n            if (gemstone.getCertificateNumber() != null && !gemstone.getCertificateNumber().trim().isEmpty()) {\r\n                String extension = \"\";\r\n                int lastDot = fileName.lastIndexOf('.');\r\n                if (lastDot > 0) {\r\n                    extension = fileName.substring(lastDot);\r\n                }\r\n                fileName = gemstone.getCertificateNumber().replaceAll(\"[^a-zA-Z0-9]\", \"_\") + extension;\r\n            }\r\n            \r\n            return ResponseEntity.ok()\r\n                    .contentType(MediaType.parseMediaType(contentType))\r\n                    .header(HttpHeaders.CONTENT_DISPOSITION, \"attachment; filename=\\\"\" + fileName + \"\\\"\")\r\n                    .body(resource);\r\n        } catch (RuntimeException e) {\r\n            return ResponseEntity.status(HttpStatus.NOT_FOUND).build();\r\n        } catch (Exception e) {\r\n            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();\r\n        }\r\n    }\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Gemora/src/main/java/gem/gembro/controller/GemstoneController.java b/Gemora/src/main/java/gem/gembro/controller/GemstoneController.java
--- a/Gemora/src/main/java/gem/gembro/controller/GemstoneController.java	(revision ae915b2386d0550b9d028b1a387a66554bd18f38)
+++ b/Gemora/src/main/java/gem/gembro/controller/GemstoneController.java	(date 1764590119524)
@@ -27,6 +27,9 @@
 @RequestMapping("/api/gemstones")
 @CrossOrigin(origins = "*")
 public class GemstoneController {
+
+    // Controller for managing gemstone listings and related seller contact/boost actions
+
     @Autowired
     private GemstoneService gemstoneService;
 
