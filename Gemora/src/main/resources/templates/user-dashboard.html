<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard | GemBro</title>
    <meta name="description" content="Browse all listed gemstones from verified sellers on GemBro.">
    <link rel="stylesheet" href="styles.css">
    <style>
        .premium-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }
        .sold-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3);
        }
        .listing-image {
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <div class="logo-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 2L6 10L16 30L26 10L16 2Z" fill="url(#dashboardLogoGradient)"/>
                        <path d="M16 2L10 8L16 14L22 8L16 2Z" fill="url(#dashboardLogoGradient2)"/>
                        <defs>
                            <linearGradient id="dashboardLogoGradient" x1="16" y1="2" x2="16" y2="30" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#6366f1"/>
                                <stop offset="50%" stop-color="#8b5cf6"/>
                                <stop offset="100%" stop-color="#ec4899"/>
                            </linearGradient>
                            <linearGradient id="dashboardLogoGradient2" x1="16" y1="2" x2="16" y2="14" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#ffffff" stop-opacity="0.3"/>
                                <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <span class="logo-text">GemBro</span>
            </a>
            <div class="nav-menu" id="navMenu">
                <a href="user-dashboard.html" class="nav-link active">Dashboard</a>
                <a href="marketplace.html" class="nav-link">Marketplace</a>
                <a href="index.html#workflow" class="nav-link">How It Works</a>
                <a href="contact.html" class="nav-link">Contact</a>
            </div>
            <div class="nav-actions">
                <span id="userName" style="color: var(--text-primary); margin-right: 16px; font-weight: 500;"></span>
                <a href="index.html" class="btn-ghost" onclick="logout()">Logout</a>
            </div>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Dashboard Hero -->
    <section class="seller-hero" style="min-height: 40vh; padding: 100px 0 60px;">
        <div class="seller-hero-bg">
            <div class="gradient-orb orb-1"></div>
            <div class="gradient-orb orb-2"></div>
        </div>
        <div class="container">
            <div class="seller-hero-content">
                <h1 class="seller-title">Welcome to Your Dashboard</h1>
                <p class="seller-subtitle">Browse all gemstones listed by verified sellers</p>
            </div>
        </div>
    </section>

    <!-- Filters -->
    <section style="padding: 40px 0; border-bottom: 1px solid var(--border-color); background: var(--bg-secondary);">
        <div class="container">
            <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
                <select id="filterType" class="form-input" style="width: auto; min-width: 150px;">
                    <option value="">All Categories</option>
                    <option value="Sapphire">Sapphire</option>
                    <option value="Ruby">Ruby</option>
                    <option value="Emerald">Emerald</option>
                    <option value="Alexandrite">Alexandrite</option>
                    <option value="Diamond">Diamond</option>
                </select>
                <select id="filterOrigin" class="form-input" style="width: auto; min-width: 150px;">
                    <option value="">All Origins</option>
                    <option value="Sri Lanka">Sri Lanka</option>
                    <option value="Myanmar">Myanmar</option>
                    <option value="Colombia">Colombia</option>
                    <option value="Other">Other</option>
                </select>
                <select id="filterStatus" class="form-input" style="width: auto; min-width: 150px;">
                    <option value="">All Status</option>
                    <option value="ACTIVE">Active</option>
                    <option value="SOLD">Sold</option>
                </select>
                <input type="text" id="searchInput" class="form-input" placeholder="Search gems..." style="flex: 1; min-width: 200px;">
                <button class="btn-gradient" onclick="applyFilters()">Search</button>
                <button class="btn-ghost" onclick="clearFilters()">Clear</button>
            </div>
        </div>
    </section>

    <!-- Listings Grid -->
    <section class="listings" style="padding: 80px 0;">
        <div class="container">
            <div id="loadingMessage" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                <p>Loading gemstones...</p>
            </div>
            <div id="errorMessage" style="display: none; text-align: center; padding: 40px; color: var(--error);">
                <p>Failed to load gemstones. Please try again later.</p>
            </div>
            <div id="noResultsMessage" style="display: none; text-align: center; padding: 40px; color: var(--text-secondary);">
                <p>No gemstones found matching your criteria.</p>
            </div>
            <div id="gemstonesGrid" class="listings-grid" style="display: none;">
                <!-- Gemstones will be dynamically loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="footer-logo">
                        <div class="logo-icon">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16 2L6 10L16 30L26 10L16 2Z" fill="url(#dashboardFooterLogoGradient)"/>
                                <path d="M16 2L10 8L16 14L22 8L16 2Z" fill="url(#dashboardFooterLogoGradient2)"/>
                                <defs>
                                    <linearGradient id="dashboardFooterLogoGradient" x1="16" y1="2" x2="16" y2="30" gradientUnits="userSpaceOnUse">
                                        <stop offset="0%" stop-color="#6366f1"/>
                                        <stop offset="50%" stop-color="#8b5cf6"/>
                                        <stop offset="100%" stop-color="#ec4899"/>
                                    </linearGradient>
                                    <linearGradient id="dashboardFooterLogoGradient2" x1="16" y1="2" x2="16" y2="14" gradientUnits="userSpaceOnUse">
                                        <stop offset="0%" stop-color="#ffffff" stop-opacity="0.3"/>
                                        <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
                                    </linearGradient>
                                </defs>
                            </svg>
                        </div>
                        <span class="logo-text">GemBro</span>
                    </div>
                    <p class="footer-description">Connecting gem experts with global buyers through authenticity, transparency, and premium support.</p>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Company</h4>
                        <a href="about.html">About</a>
                        <a href="#">Privacy Policy</a>
                        <a href="#">Terms of Service</a>
                    </div>
                    <div class="footer-column">
                        <h4>Resources</h4>
                        <a href="#">Seller Handbook</a>
                        <a href="contact.html">Support</a>
                        <a href="#">Documentation</a>
                    </div>
                    <div class="footer-column">
                        <h4>Contact</h4>
                        <a href="mailto:hello@gemmarket.app">hello@gemmarket.app</a>
                        <a href="tel:+94771234567">+94 77 123 4567</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; <span id="currentYear"></span> GemBro. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        let allGemstones = [];
        let filteredGemstones = [];

        // Load user info from sessionStorage
        function loadUserInfo() {
            const userInfo = sessionStorage.getItem('userInfo');
            if (userInfo) {
                const user = JSON.parse(userInfo);
                const userNameElement = document.getElementById('userName');
                if (userNameElement && user.fullName) {
                    userNameElement.textContent = `Hello, ${user.fullName}`;
                }
            } else {
                // If no user info, redirect to login
                window.location.href = 'login.html';
            }
        }

        // Logout function
        function logout() {
            sessionStorage.removeItem('userInfo');
            window.location.href = 'index.html';
        }

        // Load all gemstones
        function loadGemstones() {
            const loadingMessage = document.getElementById('loadingMessage');
            const errorMessage = document.getElementById('errorMessage');
            const noResultsMessage = document.getElementById('noResultsMessage');
            const gemstonesGrid = document.getElementById('gemstonesGrid');

            loadingMessage.style.display = 'block';
            errorMessage.style.display = 'none';
            noResultsMessage.style.display = 'none';
            gemstonesGrid.style.display = 'none';

            fetch('/api/gemstones')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch gemstones');
                    }
                    return response.json();
                })
                .then(data => {
                    allGemstones = data;
                    filteredGemstones = data;
                    displayGemstones(data);
                    loadingMessage.style.display = 'none';
                })
                .catch(error => {
                    console.error('Error loading gemstones:', error);
                    loadingMessage.style.display = 'none';
                    errorMessage.style.display = 'block';
                });
        }

        // Display gemstones in grid
        function displayGemstones(gemstones) {
            const gemstonesGrid = document.getElementById('gemstonesGrid');
            const noResultsMessage = document.getElementById('noResultsMessage');

            if (gemstones.length === 0) {
                gemstonesGrid.style.display = 'none';
                noResultsMessage.style.display = 'block';
                return;
            }

            gemstonesGrid.style.display = 'grid';
            noResultsMessage.style.display = 'none';

            gemstonesGrid.innerHTML = gemstones.map(gemstone => {
                const price = gemstone.price ? `$${parseFloat(gemstone.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}` : 'Price on request';
                const carat = gemstone.caratWeight ? `${gemstone.caratWeight} ct` : 'N/A';
                const imageUrl = gemstone.imageUrl || 'https://via.placeholder.com/400x300?text=Gemstone';
                const premiumBadge = gemstone.isPremiumBoosted ? '<span class="premium-badge">Premium</span>' : '';
                const statusBadge = gemstone.status === 'SOLD' ? '<span class="sold-badge">Sold</span>' : '';

                return `
                    <div class="listing-card">
                        <div class="listing-image">
                            <img src="${imageUrl}" alt="${gemstone.name || 'Gemstone'}" onerror="this.src='https://via.placeholder.com/400x300?text=Gemstone'">
                            ${premiumBadge}
                            ${statusBadge}
                        </div>
                        <div class="listing-content">
                            <h3 class="listing-title">${gemstone.name || 'Unnamed Gemstone'}</h3>
                            <div class="listing-meta">
                                <span class="listing-type">${gemstone.gemType || 'N/A'}</span>
                                <span class="listing-carat">${carat}</span>
                            </div>
                            <div class="listing-details">
                                ${gemstone.color ? `<span>Color: ${gemstone.color}</span>` : ''}
                                ${gemstone.origin ? `<span>Origin: ${gemstone.origin}</span>` : ''}
                                ${gemstone.certification ? `<span>Cert: ${gemstone.certification}</span>` : ''}
                            </div>
                            <div class="listing-footer">
                                <div class="listing-price">${price}</div>
                                <div class="listing-views">${gemstone.viewsCount || 0} views</div>
                            </div>
                            ${gemstone.description ? `<p class="listing-description">${gemstone.description.substring(0, 100)}${gemstone.description.length > 100 ? '...' : ''}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Apply filters
        function applyFilters() {
            const typeFilter = document.getElementById('filterType').value.toLowerCase();
            const originFilter = document.getElementById('filterOrigin').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            filteredGemstones = allGemstones.filter(gemstone => {
                const matchesType = !typeFilter || (gemstone.gemType && gemstone.gemType.toLowerCase().includes(typeFilter));
                const matchesOrigin = !originFilter || (gemstone.origin && gemstone.origin.toLowerCase().includes(originFilter));
                const matchesStatus = !statusFilter || gemstone.status === statusFilter;
                const matchesSearch = !searchTerm || 
                    (gemstone.name && gemstone.name.toLowerCase().includes(searchTerm)) ||
                    (gemstone.gemType && gemstone.gemType.toLowerCase().includes(searchTerm)) ||
                    (gemstone.description && gemstone.description.toLowerCase().includes(searchTerm));

                return matchesType && matchesOrigin && matchesStatus && matchesSearch;
            });

            displayGemstones(filteredGemstones);
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('filterType').value = '';
            document.getElementById('filterOrigin').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('searchInput').value = '';
            filteredGemstones = allGemstones;
            displayGemstones(allGemstones);
        }

        // Allow Enter key to trigger search
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            loadGemstones();

            // Set current year in footer
            const currentYearElement = document.getElementById('currentYear');
            if (currentYearElement) {
                currentYearElement.textContent = new Date().getFullYear();
            }

            // Add Enter key listener to search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        applyFilters();
                    }
                });
            }
        });
    </script>
</body>
</html>

